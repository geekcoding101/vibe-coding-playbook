---
trigger: glob
globs: **/*.sh
---

# Rule: Shell Scripts

## 脚本要求

- **参数解析**：使用 `getopts` 支持命令行参数，提供清晰的 `-h/--help` 说明。
- **日志文件**：重要操作需输出到日志文件，便于事后排查；使用 `tee` 同时输出到控制台和文件。
  - 日志文件命名规范：`<script_name>_<timestamp>.log`（如 `backup_2025-12-14_15-30-45.log`）
  - 时间戳格式：`$(/bin/date +%Y-%m-%d_%H-%M-%S)`
  - 支持通过命令行参数（如 `-l/--log-file`）自定义日志文件路径
- **彩色输出**：控制台日志使用 ANSI 颜色码区分不同级别（如 `INFO` 绿色、`WARN` 黄色、`ERROR` 红色），提升可读性。
- **函数复用**：将通用逻辑（参数校验、日志输出、错误处理等）抽取为函数，避免重复代码。
- **单一职责**：每个函数只做一件事，函数名清晰表达其用途（如 `validate_input`、`log_info`、`cleanup_temp_files`）。
- **注释完善**：在脚本开头说明用途、依赖、用法示例；关键函数和复杂逻辑处添加注释说明。

## 安全与健壮性

- 始终为变量加双引号：`"$VAR"`，避免单词拆分和通配符展开问题。
- 对 `rm`、`mv` 等危险命令加上路径检查或说明注释，避免误删重要文件。

## 可维护性

- 避免把复杂业务逻辑堆在 Shell 中；当逻辑变复杂时，建议改写为 Python / TS 等语言。
- 不在脚本中硬编码密码、token 或密钥；统一从环境变量或 secret 注入。

看到未加引号的变量、或疑似硬编码秘密信息时，请自动指出并给出安全版本。
